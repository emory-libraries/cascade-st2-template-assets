function urlencode(a){a=(a+"").toString();return encodeURIComponent(encodeURIComponent(a)).replace(/\-/g,"%252D").replace(/\_/g,"%255F").replace(/\./g,"%252E").replace(/\!/g,"%2521").replace(/\~/g,"%257E").replace(/\*/g,"%252A").replace(/\'/g,"%2527").replace(/\(/g,"%2528").replace(/\)/g,"%2529")}function removeParameter(b,j){var h,d,f,a,g,c;h=b.split("#");d=h[0].split("?");if(d.length>=2){f=d.shift();a=d.join("?");g=encodeURIComponent(j)+"=";c=a.split(/[&;]/g);for(var e=c.length;e-->0;){if(c[e].lastIndexOf(g,0)!==-1){c.splice(e,1)}}b=f+"?"+c.join("&");if(h[1]){b+="#"+h[1]}}return b}function addParameter(b,c,e){var d,a;d=b.indexOf("?");a=b.indexOf("#");if(d==b.length-1){b=b.substring(0,d);d=-1}return(a>0?b.substring(0,a):b)+(d>0?"&"+c+"="+e:"?"+c+"="+e)+(a>0?b.substring(a):"")}function loadPageVar(c,b){var d,a,e;if(typeof b==="undefined"){return unescape(window.location.search.replace(new RegExp("^(?:.*[&\\?]"+escape(c).replace(/[\.\+\*]/g,"\\$&")+"(?:\\=([^&]*))?)?.*$","i"),"$1"))}else{d=function(f){a=document.createElement("a");a.href=f;return a};e=d(b);return unescape(e.search.replace(new RegExp("^(?:.*[&\\?]"+escape(c).replace(/[\.\+\*]/g,"\\$&")+"(?:\\=([^&]*))?)?.*$","i"),"$1"))}}function searchClear(){var a,b;$('#main-content input[type="search"]').after('<span class="icon-clear">x</span>');if($('#main-content input[type="search"]').val().length>1){a=$('#main-content input[type="search"]');b=$(a).val().length?1:0;$(a).next(".icon-clear").stop().fadeTo(200,b)}}function setCheckboxes(c){var e,b,f,a;e=loadPageVar("subject",c);b=loadPageVar("resource_type",c);f=loadPageVar("letter",c);a=loadPageVar("status",c);$('input:checkbox[name="subject[]"]').prop("checked",false);$('input:checkbox[name="resource[]"]').prop("checked",false);$('input:checkbox[name="letter[]"]').prop("checked",false);$('input:checkbox[name="status[]"]').prop("checked",false);if(e!==""){if(e.indexOf(".")!==-1){subjects=e.split(".");for(var d=0;d<subjects.length;d++){e=encodeURIComponent(subjects[d]).toLowerCase();$('input:checkbox[value="'+e+'"][name="subject[]"]').prop("checked",true)}}else{e=encodeURIComponent(e).toLowerCase();$('input:checkbox[value="'+e+'"][name="subject[]"]').prop("checked",true)}}if(b!==""){if(b.indexOf(".")!==-1){resource_types=b.split(".");for(var d=0;d<resource_types.length;d++){b=encodeURIComponent(resource_types[d]).toLowerCase();$('input:checkbox[value="'+b+'"][name="resource_type[]"]').prop("checked",true)}}else{b=encodeURIComponent(b).toLowerCase();$('input:checkbox[value="'+b+'"][name="resource_type[]"]').prop("checked",true)}}if(f!==""){if(f.indexOf(".")!==-1){letters=f.split(".");for(var d=0;d<letters.length;d++){f=encodeURIComponent(letters[d]).toLowerCase();$('input:checkbox[value="'+f+'"][name="letter[]"]').prop("checked",true)}}else{f=encodeURIComponent(f).toLowerCase();$('input:checkbox[value="'+f+'"][name="letter[]"]').prop("checked",true)}}if(a!==""){if(a.indexOf(".")!==-1){statuses=a.split(".");for(var d=0;d<statuses.length;d++){f=encodeURIComponent(statuses[d]).toLowerCase();$('input:checkbox[value="'+a+'"][name="status[]"]').prop("checked",true)}}else{a=encodeURIComponent(a).toLowerCase();$('input:checkbox[value="'+a+'"][name="status[]"]').prop("checked",true)}}}function readCheckboxes(d,g){var e,b,f,a;var c={};if($('input:checkbox[name="subject[]"]:checked').length>0){e=$('input:checkbox[name="subject[]"]:checked').map(function(){return this.id}).get().join(".");d=addParameter(d,"subject",e);c.subject=e}else{e=""}if($('input:checkbox[name="resource_type[]"]:checked').length>0){b=$('input:checkbox[name="resource_type[]"]:checked').map(function(){return this.id}).get().join(".");d=addParameter(d,"resource_type",b);c.resource_type=b}else{b=""}if($('input:checkbox[name="letter[]"]:checked').length>0){f=$('input:checkbox[name="letter[]"]:checked').map(function(){return this.id}).get().join(".");d=addParameter(d,"letter",f);c.letter=f}else{f=""}if($('input:checkbox[name="status[]"]:checked').length>0){a=$('input:checkbox[name="status[]"]:checked').map(function(){return this.id}).get().join(".");d=addParameter(d,"status",a);c.status=a}else{a=""}if(window.location.search.indexOf("debug=true")>-1){d=addParameter(d,"debug",true)}if(window.location.search.indexOf("beta=true")>-1){d=addParameter(d,"beta",true)}return{items:c,url:d}}function getResults(c,b,a){$.each(c,function(d,e){if(e.section==="results"){return $.ajax({beforeSend:function(){$(".loading").show()},complete:function(){$(".loading").hide()},cache:true,url:b,success:function(j){var g,k,f,h,l;g=History.getState();filters=$(j).find(".filter-list");if(filters.length>0){if(g.data.subject!==undefined){k=$(j).find("ul.subject.filter-list");filter=$("ul.subject.filter-list");if(filter.length>0){filter.html($(k).prop("innerHTML"))}else{$("#subject").parent("fieldset").after('<ul class="subject filter-list unstyled well well-small clearfix">'+$(k).prop("innerHTML")+"</ul>")}}else{filter=$("#subject").parent("fieldset").next("ul.subject.filter-list");if(filter.length>0){filter.remove()}}if(g.data.resource_type!==undefined){f=$(j).find("ul.resource_type.filter-list");filter=$("ul.resource_type.filter-list");if(filter.length>0){filter.html($(f).prop("innerHTML"))}else{$("#resource_type").parent("fieldset").after('<ul class="resource_type filter-list unstyled well well-small clearfix">'+$(f).prop("innerHTML")+"</ul>")}}else{filter=$("#resource_type").parent("fieldset").next("ul.resource_type.filter-list");if(filter.length>0){filter.remove()}}if(g.data.letter!==undefined){h=$(j).find("ul.letter.filter-list");filter=$("ul.letter.filter-list");if(filter.length>0){filter.html($(h).prop("innerHTML"))}else{$("#letter").parent("fieldset").after('<ul class="letter filter-list unstyled well well-small clearfix">'+$(h).prop("innerHTML")+"</ul>")}}else{filter=$("#letter").parent("fieldset").next("ul.letter.filter-list");if(filter.length>0){filter.remove()}}if(g.data.status!==undefined){l=$(j).find("ul.status.filter-list");filter=$("ul.status.filter-list");if(filter.length>0){filter.html($(l).prop("innerHTML"))}else{$("#status").parent("fieldset").after('<ul class="status filter-list unstyled well well-small clearfix">'+$(l).prop("innerHTML")+"</ul>")}}else{filter=$("#status").parent("fieldset").next("ul.status.filter-list");if(filter.length>0){filter.remove()}}}form=$(j).find(".database-search");parsed_results=$(j).find(".databases");pagination=$(j).find(".pagination");$(".database-search").html($(form).prop("innerHTML"));searchClear();typeaheadSetup(false);a.html($(parsed_results).prop("innerHTML"));expandDetails();if(pagination.length>0){$(".pagination").html($(pagination).prop("innerHTML"))}else{$(".pagination").html("")}},error:function(f){return false},dataType:"html"})}})}function prepareForm(){var d,b,a,g,f,h,c,l,e,j,k;d=$(".databases .database-search");searchClear();b=$(".databases");$(b).before('<div class="loading"><img src="https://template.emory.edu/assets/wdg/css/img/loader.gif" /> Loading Database Results</div>');g=document.title;l=[];a="";e=window.History;j=e.getState();$.each($("form#database-filter .accordion-body > li a, form#database-filter .standard > li a"),function(){h=$(this).parent().parent().attr("id");c=urlencode($(this).text()).toLowerCase();if(c==="0%252d9"){c="0-9"}$(this).wrap('<label class="checkbox">');$(this).before('<input type="checkbox" name="'+h+'[]" id="'+c+'" value="'+c+'" />');$(this).contents().unwrap()});$("form#database-filter .accordion-heading > a").after('<span class="icon-angle-right"></span>');$(".collapse").on("show",function(){$(this).parent().find(".icon-angle-right").removeClass("icon-angle-right").addClass("icon-angle-down")}).on("hide",function(){$(this).parent().find(".icon-angle-down").removeClass("icon-angle-down").addClass("icon-angle-right")});$("form#database-filter .accordion-body.in").parent().find(".accordion-heading span").removeClass("icon-angle-right").addClass("icon-angle-down");setCheckboxes();$(".accordion-toggle").click(function(m){m.preventDefault()});if($(".database-search").length>0){l.push({selector:".database-search",section:"form"})}if($(".featured-databases").length>0){l.push({selector:".featured-databases",section:"results",status:"featured",title:$(".featured-databases").data("title")})}if($(".new-databases").length>0){l.push({selector:".new-databases",section:"results",status:"new",title:$(".new-databases").data("title")})}if($(".trial-databases").length>0){l.push({selector:".trial-databases",section:"results",status:"trial",title:$(".trial-databases").data("title")})}if($(".default-databases").length>0){l.push({selector:".default-databases",section:"results",status:"default",title:$(".default-databases").data("title")})}if($(".no-results").length>0){l.push({selector:".no-results",section:"results",status:"empty",title:$(".no-results").data("title")})}if($(".pagination").length>0){l.push({selector:".pagination",section:"pagination"})}l=l.sort();a="";$("#database-filter").on("change",function(m){var s,v,u,o,q,p,t;a="";s=$(m.target);a=$("#database-filter").data("url");a=removeParameter(a,"start");clearTimeout(k);if($("#db_q").val()){a=addParameter(a,"q",$("#db_q").val())}else{a=addParameter(a,"q",$("#q").val())}p=readCheckboxes(a,m);t=p.items;a=p.url;if(s.is(":not(:checked)")){var r,w,n;r=s.parent().text();w=s.parents("ul").attr("id");n=$("#"+w).parent("fieldset").next(".filter-list");$(n).find("li").each(function(){if($(this).text().slice(0,-1)==r){$(this).remove();if(n.children().length<2){n.remove()}}})}k=setTimeout(function(){e.pushState(t,g,a)},500)});$(document).on("click",".filter-list a.remove",function(p){p.preventDefault();var n,m,q,o;m=$(this).parent().parent("li");if(m.length>0){q=urlencode($(this).parent().text().slice(0,-1)).toLowerCase();n=m.parent();o=n.prev("fieldset").find("ul").attr("id")}else{q=urlencode($(this).text().slice(0,-1)).toLowerCase();m=$(this).parent("li");n=m.parent();o=m.attr("class")}if(q==="0%252d9"){q="0-9"}$("#"+o).find('input:checkbox[value="'+q+'"]').click();m.remove();if(n.children().length<2){n.remove()}});$(document).on("submit","form",function(o){var r,q,p,n,m;if(o.target.id==="database-search"||$("#search-databases").prop("checked")===true){n=readCheckboxes(a,o);m=n.items;a="";if($("input#db_q").length>0){a="";r=$(this).serializeArray();jQuery.each(r,function(s,t){if(t.name==="db_q"||t.name==="q"){p=urlencode(t.value)}else{p=t.value}if(s==0){a+="?"}else{a+="&"}a+=t.name+"="+p});e.pushState(m,g,a);return false}}});$(document).on("propertychange keyup input paste",'#main-content input[type="search"]',function(){var m=$(this).val().length?1:0;$(this).next(".icon-clear").stop().fadeTo(200,m)});$(document).on("click",".icon-clear",function(m){$(this).delay(200).fadeTo(200,0).prev("input").val("");$(this).parents("form").submit()});$(document).on("click",".pagination a",function(m){m.preventDefault();$("body,html").animate({scrollTop:0},600);a=$(this).attr("href");e.pushState(null,g,a)});e.Adapter.bind(window,"statechange",function(){j=e.getState();setCheckboxes(j.url);getResults(l,j.url,b)})}history.navigationMode="compatible";function expandDetails(){$(".databases .listings a.expand").click(function(b){$(this).prev(".database-details").toggleClass("collapse");$(this).parent().toggleClass("expanded");var a='Expand <span class="icon-angle-down"></span>';var c='Collapse <span class="icon-angle-up"></span>';switch($(this).html()){case a:$(this).html(c);break;case c:$(this).html(a);break}b.preventDefault()})}function typeaheadSetup(d){var c,b,a;c=$(".database-search .ajax-typeahead");if(c.length>0){b=c.data("url");a=b.indexOf("?")==-1?"?":"&";b=b+a;if(d===true){c.typeahead({limit:100,prefetch:{url:b,filter:function(e){var f=[];if(e.RES!==undefined){f=getTypeaheadDatabase(e,b)}return f}},remote:{url:b+"q=%QUERY",filter:function(e){var f=[];if(e.RES!==undefined){f=getTypeaheadDatabase(e,b)}return f}},template:['<p class="ta-h1">{{value}}</p>'].join(""),engine:Hogan})}else{c.typeahead({limit:100,remote:{url:b+"q=%QUERY",filter:function(e){var f=[];if(e.RES!==undefined){f=getTypeaheadDatabase(e,b)}return f}},template:['<p class="ta-h1">{{value}}</p>'].join(""),engine:Hogan})}c.on("typeahead:selected",function(f,e){window.location=e.redirect_url});$(".twitter-typeahead").addClass("span10");$(".tt-hint").addClass("input span12");$(".tt-query").css("width","100%");if(Modernizr.mq("screen and (max-width:767px)")){$(".database-search.big-search .btn").addClass("typeahead")}}}function getTypeaheadDatabase(b,a){var c=[];if(b.RES.M==1){$.each(b.RES.R.MT,function(d,e){if(e["@attributes"].N=="full_title"){b.RES.R.T=e["@attributes"].V}});$.each(b.RES.R.MT,function(d,e){if(e["@attributes"].N=="full_description"){b.RES.R.S=e["@attributes"].V}});$.each(b.RES.R.MT,function(d,e){if(e["@attributes"].N=="external_link"){b.RES.R.U=e["@attributes"].V}});b.RES.R.combined=b.RES.R.T;c.push({name:b.RES.R.T,description:b.RES.R.S,language:"en",value:b.RES.R.combined,redirect_url:b.RES.R.U,tokens:b.RES.R.T})}else{if(b.RES.M>1){for(i=0;i<b.RES.R.length;i++){$.each(b.RES.R[i].MT,function(d,e){if(e["@attributes"].N=="full_title"){b.RES.R[i].T=e["@attributes"].V}});$.each(b.RES.R[i].MT,function(d,e){if(e["@attributes"].N=="full_description"){b.RES.R[i].S=e["@attributes"].V}});$.each(b.RES.R[i].MT,function(d,e){if(e["@attributes"].N=="external_link"){b.RES.R[i].U=e["@attributes"].V}});b.RES.R[i].combined=b.RES.R[i].T;c.push({name:b.RES.R[i].T,description:b.RES.R[i].S,language:"en",value:b.RES.R[i].combined,redirect_url:b.RES.R[i].U,tokens:b.RES.R[i].T})}}}return c}$(function(){prepareForm();expandDetails();typeaheadSetup(true)});